<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>用户管理</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" href="${request.contextPath}/layuiadmin/layui/css/layui.css" media="all">
</head>
<body>
<div id="authTree" class="demo-tree-more"></div>
<script src="${request.contextPath}/layuiadmin/layui/layui.js" charset="utf-8"></script>
<script>
//初始化
function initData(result) {
    layui.use(['tree'],
    function() {
        var $ = layui.$,
        tree = layui.tree;
        tree.render({
            elem: '#authTree',
            data: result.dataList,
            showCheckbox: true,
            id: 'treeId'
        });
    });
}
//确定提交
function submitData(roleId){
    layui.use(['tree'],
    function() {
        var $ = layui.$,
        tree = layui.tree,
        layer = layui.layer;
        var checkData = tree.getChecked('treeId');
        var resourceIds=[];
        loopTree(checkData,resourceIds);
        var data = {roleId : roleId,resourceIds : resourceIds.join(",")};
        $.ajax({
            url: '/sys/role/auth',
            type: 'post',
            dataType: 'text',
            data: data,
            success: function(data) {
                var result = JSON.parse(data);
                if (result.transactionStatus.success) {
                    parent.layer.msg("授权成功");
                } else {
                    parent.layer.msg(result.transactionStatus.replyText);
                }
            }
        });
    });
}
//递归遍历
function loopTree(checkData,resourceIds){
    for (var i = 0; i < checkData.length; i++) {
        var children = checkData[i].children;
        if (children.length == 0) {
            resourceIds.push(checkData[i].id);
        } else {
            resourceIds.push(checkData[i].id);
            loopTree(children, resourceIds);
        }
    }
    return resourceIds;
}
</script>
</body>
</html>